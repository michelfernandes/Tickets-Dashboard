<!DOCTYPE html>
<html>
<head>
  <title>IT Tickets</title>
  <script src="xlsx.full.min.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css">
  <style>
  body{
    color: #49c3d9;
    background-color: #1d1e1e;
  }
  table tbody{
    color: white;
  }
  table{
    width: 105%;
    max-width: 105%;
    font-size: 1.2rem;
  }
  .title{
    padding: .3em;
    overflow-y:auto;
  }
  .back-gray{
    background-color: #303030;
  }
  .list-status{
    padding:3px;
    border-radius:5px;
  }
  .div-table{
    padding:1em;
  }
  .div-printer{
    margin: .5em 0;
    height: 18em;
    overflow-y:hidden;
  }
  .div-lenovo{
    padding-bottom: .5em;
    margin: .5em 0;
    height: 30em;
    overflow-y:hidden;
  }
  </style>
</head>
<body>
    <div class="back-gray text-center title">
      <h1>IT Tickets Management</h1>
    </div>

    <div class="row div-printer">
      <div class="col-md-2">

        <div class="row text-center">
          <div class="col-md-12">
            <div class="card back-gray mb-3" style="max-width: 20rem;">
              <div class="card-body">
                <h4 class="card-title">Expired</h4>
                <h4 id="printer-card1" class="card-text">1</h4>
              </div>
            </div>
          </div>
          <div class="col">
            <div class="card back-gray mb-3" style="max-width: 20rem;">
              <div class="card-body">
                <h4 class="card-title">Open</h4>
                <h4 id="printer-card2" class="card-text">2</h4>
              </div>
            </div>
          </div>
          <div class="col">
            <div class="card back-gray mb-3" style="max-width: 20rem;">
              <div class="card-body">
                <h4 class="card-title">Closed</h4>
                <h4 id="printer-card3" class="card-text">3</h4>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class=" back-gray col-md-10">

        <div class="div-table">
          <table class="table table-sm">
            <thead>
              <tr>
                <th>#</th>
                <th>Equipamento</th>
                <th>Tecnico</th>
                <th>Data Abertura</th>
                <th>Data Fechamento</th>
                <th>SLA</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="printer-tbodyid">
              <!--<tr>
                <th scope="row">2</th>
                <td>HP LaserJet M5035 MFP - HP</td>
                <td>Alex Longaray</td>
                <td>08/07/2017</td>
                <td>01/09/2017</td>
                <td>15/07/2017</td>
                <td class="bg-warning list-status"><span >Dentro do prazo</span></td>
              </tr>-->
            </tbody>
          </table>
        </div>
      </div>
    </div>

  <div class="row div-lenovo">
    <div class="col-md-2">

              <div class="row text-center">
                <div class="col-md-12">
                  <div class="card back-gray mb-3" style="max-width: 20rem;">
                    <div class="card-body">
                      <h4 class="card-title">Expired</h4>
                      <h4 id="lenovo-card1" class="card-text">1</h4>
                    </div>
                  </div>
                </div>
                <div class="col">
                  <div class="card back-gray mb-3" style="max-width: 20rem;">
                    <div class="card-body">
                      <h4 class="card-title">Open</h4>
                      <h4 id="lenovo-card2" class="card-text">2</h4>
                    </div>
                  </div>
                </div>
                <div class="col">
                  <div class="card back-gray mb-3" style="max-width: 20rem;">
                    <div class="card-body">
                      <h4 class="card-title">Closed</h4>
                      <h4 id="lenovo-card3" class="card-text">3</h4>
                    </div>
                  </div>
                </div>
              </div>
      </div>

            <div class=" back-gray col-md-10">

              <div class="div-table">
                <table class="table table-sm">
                  <thead>
                    <tr>
                      <th>#</th>
                      <th>User</th>
                      <th>Ticket #</th>
                      <th>Where</th>
                      <th>Data Abertura</th>
                      <th>Data Fechamento</th>
                      <th>SLA</th>
                      <th>Status</th>
                    </tr>
                  </thead>
                  <tbody id="lenovo-tbodyid">
                    <!--<tr>
                      <th scope="row">1</th>
                      <td>HP LaserJet P4015 (SLEF_2E) - HP</td>
                      <td>Alex Longaray</td>
                      <td>08/07/2017</td>
                      <td>01/09/2017</td>
                      <td>15/07/2017</td>
                      <td>15/07/2017</td>
                      <td class="bg-success list-status"><span >Resolvido</span></td>
                    </tr>-->

                  </tbody>
                </table>
              </div>
            </div>
            </div>


</body>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js"></script>
  <script>
  /* set up XMLHttpRequest */
  var workbook;
  var oReq = new XMLHttpRequest();

  function getData(e) {
    var arraybuffer = oReq.response;

    /* convert data to binary string */
    var data = new Uint8Array(arraybuffer);
    var arr = new Array();
    for(var i = 0; i != data.length; ++i) arr[i] = String.fromCharCode(data[i]);
    var bstr = arr.join("");

    /* Call XLSX */
    workbook = XLSX.read(bstr, {type:"binary"});

    /* DO SOMETHING WITH workbook HERE */
    updateData();

  }

  function updateData(){
    console.log('das');
    sheet_name = workbook.SheetNames[7];
    worksheet = workbook.Sheets[sheet_name];
    jsonObject = (XLSX.utils.sheet_to_json(worksheet));
    $('#printer-tbodyid').empty();
    let class_status = '';
    let s1=0,s2=0,s3=0;
    for(let i=jsonObject.length-1; i>=0; i--){
      if((jsonObject.length-1 - i) >= 5){break;}

      if(jsonObject[i]['Situacao'] === 'Resolvido'){
        class_status = 'bg-success';
        s1++;
      }else if (jsonObject[i]['Situacao'] === 'Dentro do Prazo') {
        class_status = 'bg-warning';
        s2++;
      }else if (jsonObject[i]['Situacao'] === 'Contatar HP') {
        class_status = 'bg-danger';
        s3++;
      }

      $('#printer-tbodyid').append($('<tr>')
                   .append($('<th>').attr('scope','row').text(jsonObject.length - i))
                   .append($('<td>').text(jsonObject[i]['Equipamento']))
                   .append($('<td>').text(jsonObject[i]['Tecnico']))
                   .append($('<td>').text(jsonObject[i]['Data_Abertura']))
                   .append($('<td>').text(jsonObject[i]['Data_Fechamento']))
                   .append($('<td>').text(jsonObject[i]['SLA']))
                   .append($('<td>').addClass(class_status).addClass('list-status').text(jsonObject[i]['Situacao']))
                 )
    }
    $("#printer-card1").html(s3);
    $("#printer-card2").html(s2);
    $("#printer-card3").html(s1);

    sheet_name = workbook.SheetNames[5];
    worksheet = workbook.Sheets[sheet_name];
    jsonObject = (XLSX.utils.sheet_to_json(worksheet));

    $('#lenovo-tbodyid').empty();
    s1=0;
    s2=0;
    s3=0;
    for(let i=jsonObject.length-1; i>=0; i--){
      if((jsonObject.length-1 - i) >= 10){break;}

      if(jsonObject[i]['Status'] === 'Closed'){
        class_status = 'bg-success';
        s1++;
      }else if (jsonObject[i]['Status'] === 'Open') {
        class_status = 'bg-warning';
        s2++;
      }else if (jsonObject[i]['Status'] === 'Expired') {
        class_status = 'bg-danger';
        s3++;
      }

      $('#lenovo-tbodyid').append($('<tr>')
                   .append($('<th>').attr('scope','row').text(jsonObject.length - i))
                   .append($('<td>').text(jsonObject[i]['User']))
                   .append($('<td>').text(jsonObject[i]['Ticket']))
                   .append($('<td>').text(jsonObject[i]['Where']))
                   .append($('<td>').text(jsonObject[i]['Data_Abertura']))
                   .append($('<td>').text(jsonObject[i]['Data_Fechamento']))
                   .append($('<td>').text(jsonObject[i]['SLA']))
                   .append($('<td>').addClass(class_status).addClass('list-status').text(jsonObject[i]['Status']))
                 )
    }

    $("#lenovo-card1").html(s3);
    $("#lenovo-card2").html(s2);
    $("#lenovo-card3").html(s1);

  }

  function v(){

    var url = "Printers_Management.xls";
    oReq.open("GET", url, true);
    oReq.responseType = "arraybuffer";
    oReq.onload = getData;

    oReq.send();

  }

  setInterval(getXLS, 10000);

  </script>

</html>
